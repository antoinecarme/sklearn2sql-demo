-- This SQL code was generated by scikit2sql (development version).
-- Copyright 2017

WITH "IL" AS 
(SELECT "ADS"."KEY" AS "KEY", "ADS"."Feature_0" AS "Feature_0", "ADS"."Feature_1" AS "Feature_1", "ADS"."Feature_2" AS "Feature_2", "ADS"."Feature_3" AS "Feature_3", "ADS"."Feature_4" AS "Feature_4", "ADS"."Feature_5" AS "Feature_5", "ADS"."Feature_6" AS "Feature_6", "ADS"."Feature_7" AS "Feature_7", "ADS"."Feature_8" AS "Feature_8", "ADS"."Feature_9" AS "Feature_9" 
FROM "BinaryClass_10" AS "ADS"), 
"HL_BA_1" AS 
(SELECT "IL"."KEY" AS "KEY", -0.655674474082 * "IL"."Feature_0" + -0.228082737911 * "IL"."Feature_1" + -0.237961341893 * "IL"."Feature_2" + 0.39603497442 * "IL"."Feature_3" + -0.0762665747015 * "IL"."Feature_4" + 0.016035276867 * "IL"."Feature_5" + -0.222785267382 * "IL"."Feature_6" + 0.451694136656 * "IL"."Feature_7" + 0.480622666757 * "IL"."Feature_8" + -0.726631801425 * "IL"."Feature_9" + -0.950079358466 AS "NEUR_1_1", 2.12746341474 * "IL"."Feature_0" + 0.944736599668 * "IL"."Feature_1" + -2.21671314219 * "IL"."Feature_2" + -3.59978317298 * "IL"."Feature_3" + -0.447019308107 * "IL"."Feature_4" + 2.42833836766 * "IL"."Feature_5" + -1.01469713662 * "IL"."Feature_6" + 0.995302489903 * "IL"."Feature_7" + 0.940702329927 * "IL"."Feature_8" + 1.14543332431 * "IL"."Feature_9" + -0.41935412293 AS "NEUR_1_2", -0.718902812928 * "IL"."Feature_0" + 1.08176677872 * "IL"."Feature_1" + -2.43412392265 * "IL"."Feature_2" + -3.17546338052 * "IL"."Feature_3" + -1.04941737006 * "IL"."Feature_4" + 3.79375286949 * "IL"."Feature_5" + -0.769972707172 * "IL"."Feature_6" + -0.70164239907 * "IL"."Feature_7" + -0.266735142459 * "IL"."Feature_8" + 0.646984152216 * "IL"."Feature_9" + -0.616991682722 AS "NEUR_1_3" 
FROM "IL"), 
"HL_1_relu" AS 
(SELECT "HL_BA_1"."KEY" AS "KEY", CASE WHEN ("HL_BA_1"."NEUR_1_1" >= 0.0) THEN "HL_BA_1"."NEUR_1_1" ELSE 0.0 END AS "NEUR_1_1", CASE WHEN ("HL_BA_1"."NEUR_1_2" >= 0.0) THEN "HL_BA_1"."NEUR_1_2" ELSE 0.0 END AS "NEUR_1_2", CASE WHEN ("HL_BA_1"."NEUR_1_3" >= 0.0) THEN "HL_BA_1"."NEUR_1_3" ELSE 0.0 END AS "NEUR_1_3" 
FROM "HL_BA_1"), 
"HL_BA_2" AS 
(SELECT "HL_1_relu"."KEY" AS "KEY", -0.0885189023432 * "HL_1_relu"."NEUR_1_1" + -0.852219028603 * "HL_1_relu"."NEUR_1_2" + -1.08913424962 * "HL_1_relu"."NEUR_1_3" + -1.79774014266 AS "NEUR_2_1", 0.319246954767 * "HL_1_relu"."NEUR_1_1" + 0.376918206977 * "HL_1_relu"."NEUR_1_2" + -0.683390751736 * "HL_1_relu"."NEUR_1_3" + -0.640138909745 AS "NEUR_2_2", -0.386790183657 * "HL_1_relu"."NEUR_1_1" + 2.27345397103 * "HL_1_relu"."NEUR_1_2" + 0.0575416768677 * "HL_1_relu"."NEUR_1_3" + -0.960389330648 AS "NEUR_2_3", -0.300884386144 * "HL_1_relu"."NEUR_1_1" + 0.868085687752 * "HL_1_relu"."NEUR_1_2" + -1.05267904584 * "HL_1_relu"."NEUR_1_3" + -1.56040603635 AS "NEUR_2_4", 0.323710891197 * "HL_1_relu"."NEUR_1_1" + -0.380262325494 * "HL_1_relu"."NEUR_1_2" + -0.359113121566 * "HL_1_relu"."NEUR_1_3" + -0.647137584811 AS "NEUR_2_5" 
FROM "HL_1_relu"), 
"HL_2_relu" AS 
(SELECT "HL_BA_2"."KEY" AS "KEY", CASE WHEN ("HL_BA_2"."NEUR_2_1" >= 0.0) THEN "HL_BA_2"."NEUR_2_1" ELSE 0.0 END AS "NEUR_2_1", CASE WHEN ("HL_BA_2"."NEUR_2_2" >= 0.0) THEN "HL_BA_2"."NEUR_2_2" ELSE 0.0 END AS "NEUR_2_2", CASE WHEN ("HL_BA_2"."NEUR_2_3" >= 0.0) THEN "HL_BA_2"."NEUR_2_3" ELSE 0.0 END AS "NEUR_2_3", CASE WHEN ("HL_BA_2"."NEUR_2_4" >= 0.0) THEN "HL_BA_2"."NEUR_2_4" ELSE 0.0 END AS "NEUR_2_4", CASE WHEN ("HL_BA_2"."NEUR_2_5" >= 0.0) THEN "HL_BA_2"."NEUR_2_5" ELSE 0.0 END AS "NEUR_2_5" 
FROM "HL_BA_2"), 
"OL_BA" AS 
(SELECT "HL_2_relu"."KEY" AS "KEY", -0.122048713867 * "HL_2_relu"."NEUR_2_1" + -0.367404292088 * "HL_2_relu"."NEUR_2_2" + -1.40288631098 * "HL_2_relu"."NEUR_2_3" + -1.77731373199 * "HL_2_relu"."NEUR_2_4" + -0.641764053838 * "HL_2_relu"."NEUR_2_5" + 2.369988804 AS "NEUR_3_1" 
FROM "HL_2_relu"), 
"OL_logistic" AS 
(SELECT "OL_BA"."KEY" AS "KEY", 1.0 / (1.0 + exp(-"OL_BA"."NEUR_3_1")) AS "NEUR_3_1" 
FROM "OL_BA"), 
orig_cte AS 
(SELECT "OL_logistic"."KEY" AS "KEY", CAST(NULL AS FLOAT) AS "Score_0", CAST(NULL AS FLOAT) AS "Score_1", 1.0 - "OL_logistic"."NEUR_3_1" AS "Proba_0", "OL_logistic"."NEUR_3_1" AS "Proba_1", CAST(NULL AS FLOAT) AS "LogProba_0", CAST(NULL AS FLOAT) AS "LogProba_1", CAST(NULL AS FLOAT) AS "Decision" 
FROM "OL_logistic"), 
score_class_union AS 
(SELECT scu."KEY" AS "KEY", scu.class AS class, scu."LogProba" AS "LogProba", scu."Proba" AS "Proba", scu."Score" AS "Score" 
FROM (SELECT orig_cte."KEY" AS "KEY", 0 AS class, orig_cte."LogProba_0" AS "LogProba", orig_cte."Proba_0" AS "Proba", orig_cte."Score_0" AS "Score" 
FROM orig_cte UNION ALL SELECT orig_cte."KEY" AS "KEY", 1 AS class, orig_cte."LogProba_1" AS "LogProba", orig_cte."Proba_1" AS "Proba", orig_cte."Score_1" AS "Score" 
FROM orig_cte) AS scu), 
score_max AS 
(SELECT orig_cte."KEY" AS "KEY", orig_cte."Score_0" AS "Score_0", orig_cte."Score_1" AS "Score_1", orig_cte."Proba_0" AS "Proba_0", orig_cte."Proba_1" AS "Proba_1", orig_cte."LogProba_0" AS "LogProba_0", orig_cte."LogProba_1" AS "LogProba_1", orig_cte."Decision" AS "Decision", (SELECT max(score_class_union."LogProba") AS max_1 
FROM score_class_union 
WHERE orig_cte."KEY" = score_class_union."KEY") AS "max_LogProba", (SELECT max(score_class_union."Proba") AS max_2 
FROM score_class_union 
WHERE orig_cte."KEY" = score_class_union."KEY") AS "max_Proba", (SELECT max(score_class_union."Score") AS max_3 
FROM score_class_union 
WHERE orig_cte."KEY" = score_class_union."KEY") AS "max_Score" 
FROM orig_cte), 
arg_max_cte AS 
(SELECT score_max."KEY" AS "KEY", score_max."Score_0" AS "Score_0", score_max."Score_1" AS "Score_1", score_max."Proba_0" AS "Proba_0", score_max."Proba_1" AS "Proba_1", score_max."LogProba_0" AS "LogProba_0", score_max."LogProba_1" AS "LogProba_1", score_max."Decision" AS "Decision", score_max."max_LogProba" AS "max_LogProba", score_max."max_Proba" AS "max_Proba", score_max."max_Score" AS "max_Score", (SELECT min(score_class_union.class) AS min_1 
FROM score_class_union 
WHERE score_max."max_LogProba" = score_class_union."LogProba" AND score_max."KEY" = score_class_union."KEY") AS "arg_max_LogProba", (SELECT min(score_class_union.class) AS min_2 
FROM score_class_union 
WHERE score_max."max_Proba" = score_class_union."Proba" AND score_max."KEY" = score_class_union."KEY") AS "arg_max_Proba", (SELECT min(score_class_union.class) AS min_3 
FROM score_class_union 
WHERE score_max."max_Score" = score_class_union."Score" AND score_max."KEY" = score_class_union."KEY") AS "arg_max_Score" 
FROM score_max)
 SELECT arg_max_cte."KEY" AS "KEY", arg_max_cte."Score_0" AS "Score_0", arg_max_cte."Score_1" AS "Score_1", arg_max_cte."Proba_0" AS "Proba_0", arg_max_cte."Proba_1" AS "Proba_1", CASE WHEN (arg_max_cte."Proba_0" IS NULL OR arg_max_cte."Proba_0" > 0.0) THEN ln(arg_max_cte."Proba_0") ELSE -1.79769313486231e+308 END AS "LogProba_0", CASE WHEN (arg_max_cte."Proba_1" IS NULL OR arg_max_cte."Proba_1" > 0.0) THEN ln(arg_max_cte."Proba_1") ELSE -1.79769313486231e+308 END AS "LogProba_1", arg_max_cte."arg_max_Proba" AS "Decision" 
FROM arg_max_cte